{"version":3,"sources":["../../../lib/sockets/index.js"],"names":["chat","require","rooms","messages","module","exports","up","io","on","socket","console","log","emit","connection","data","join","room","roomName","users","push","user","to","isUserNameCorrect","isRoomNameCorrect","roomIndex","forEach","elem","idx","arr","el","id","a"],"mappings":"AAAA;;AAEA,IAAMA,OAAOC,QAAQ,UAAR,CAAb;;AAEA,IAAIC,QAAQ,EAAZ;AAAA,IACIC,WAAW,EADf;;AAIAC,OAAOC,OAAP,CAAeC,EAAf,GAAoB,UAAUC,EAAV,EAAc;AAC9BA,OAAGC,EAAH,CAAM,YAAN,EAAoB,UAAUC,MAAV,EAAkB;AAClCC,gBAAQC,GAAR,CAAY,sBAAZ;AACAF,eAAOG,IAAP,CAAY,aAAZ,EAA2B,EAACC,YAAY,IAAb,EAA3B;;AAEAJ,eAAOD,EAAP,CAAU,aAAV,EAAyB,UAAUM,IAAV,EAAgB;AACrCL,mBAAOM,IAAP,CAAYD,KAAKE,IAAjB;;AAEA,gBAAIA,OAAO;AACPC,0BAAUH,KAAKE,IADR;AAEPE,uBAAO,EAFA;AAGPf,0BAAU;AAHH,aAAX;AAKAa,iBAAKE,KAAL,CAAWC,IAAX,CAAgBL,KAAKM,IAArB;AACAlB,kBAAMiB,IAAN,CAAWH,IAAX;AACAT,eAAGc,EAAH,CAAML,KAAKC,QAAX,EAAqBL,IAArB,CAA0B,UAA1B,EAAsCE,KAAKE,IAA3C;AACAT,eAAGc,EAAH,CAAML,KAAKC,QAAX,EAAqBL,IAArB,CAA0B,YAA1B,EAAwCE,KAAKM,IAA7C;AACH,SAZD;;AAcAX,eAAOD,EAAP,CAAU,UAAV,EAAsB,UAAUM,IAAV,EAAgB;AAClC,gBAAIQ,oBAAoB,IAAxB;AACA,gBAAIC,oBAAoB,KAAxB;AACA,gBAAIC,kBAAJ;AACAtB,kBAAMuB,OAAN,CAAc,UAAUC,IAAV,EAAgBC,GAAhB,EAAqBC,GAArB,EAA0B;AACpC,oBAAIF,KAAKT,QAAL,KAAkBH,KAAKE,IAA3B,EAAiC;AAC7BP,2BAAOM,IAAP,CAAYD,KAAKE,IAAjB;AACAO,wCAAoB,IAApB;AACAC,gCAAYG,GAAZ;AACH;AACDD,qBAAKR,KAAL,CAAWO,OAAX,CAAmB,UAAUI,EAAV,EAAcC,EAAd,EAAkBC,CAAlB,EAAqB;AACpC,wBAAIF,OAAOf,KAAKM,IAAhB,EAAsB;AAClBE,4CAAoB,KAApB;AACH;AACJ,iBAJD;AAKH,aAXD;AAYA,gBAAIC,qBAAqBD,iBAAzB,EAA4C;AACxCpB,sBAAMsB,SAAN,EAAiBN,KAAjB,CAAuBC,IAAvB,CAA4BL,KAAKM,IAAjC;AACA;AACAV,wBAAQC,GAAR,CAAYT,MAAMsB,SAAN,EAAiBN,KAA7B;AACAT,uBAAOG,IAAP,CAAY,YAAZ,EAA0BV,MAAMsB,SAAN,CAA1B;AACAjB,mBAAGc,EAAH,CAAMP,KAAKE,IAAX,EAAiBJ,IAAjB,CAAsB,gBAAtB,EAAwCV,MAAMsB,SAAN,EAAiBN,KAAzD;AACH;AACJ,SAvBD;;AAyBA;;;;;;AASA;;;;;;;;;;;;;;;AAkBH,KAtED;;AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,CAjFD","file":"index.js","sourcesContent":["'use strict';\n\nconst chat = require('lib/chat');\n\nlet rooms = [],\n    messages = [];\n\n\nmodule.exports.up = function (io) {\n    io.on('connection', function (socket) {\n        console.log('socket is connected!');\n        socket.emit('testConnect', {connection: true});\n\n        socket.on('create room', function (data) {\n            socket.join(data.room);\n\n            let room = {\n                roomName: data.room,\n                users: [],\n                messages: []\n            };\n            room.users.push(data.user);\n            rooms.push(room);\n            io.to(room.roomName).emit('add room', data.room);\n            io.to(room.roomName).emit('add client', data.user);\n        });\n\n        socket.on('try join', function (data) {\n            let isUserNameCorrect = true;\n            let isRoomNameCorrect = false;\n            let roomIndex;\n            rooms.forEach(function (elem, idx, arr) {\n                if (elem.roomName === data.room) {\n                    socket.join(data.room);\n                    isRoomNameCorrect = true;\n                    roomIndex = idx;\n                }\n                elem.users.forEach(function (el, id, a) {\n                    if (el === data.user) {\n                        isUserNameCorrect = false;\n                    }\n                });\n            });\n            if (isRoomNameCorrect && isUserNameCorrect) {\n                rooms[roomIndex].users.push(data.user);\n                // console.log(`${roomIndex} and ${data.user}`);\n                console.log(rooms[roomIndex].users);\n                socket.emit('after join', rooms[roomIndex]);\n                io.to(data.room).emit('update clients', rooms[roomIndex].users);\n            }\n        });\n\n        /*socket.on('new message', function (data) {\n            console.log(data.username);\n            console.log(new Date(data.date).getDate());\n            console.log(data.text);\n        });*/\n\n\n\n\n        /*\n                let name = false;\n\n                socket.emit('messages', chat_parts.getLast());\n\n                socket.on('name/set', function(data) {\n                    console.log('set name', name);\n                    name = data;\n                });\n\n                socket.on('message', function(data) {\n                    let message = {\n                        name: data.name,\n                        message: data.message\n                    };\n                    console.log(message);\n                    chat.send(message);\n                });*/\n    });\n\n\n    // module.exports.sendAll = function (eventName, data) {\n    //    io.sockets.emit(eventName, data);\n    // };\n    //\n    // module.exports.sendMessageAll = function (eventName, data) {\n    //    sendAll(eventName, data);\n    // }\n};"]}